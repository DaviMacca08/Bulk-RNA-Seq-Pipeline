summarise(mean_delay = mean(dep_delay, na.rm = TRUE)) |>
arrange(mean_delay) |>
ggplot(aes(x = mean_delay, y = dep_delay)) +
geom_line()
flights_dt |>
mutate(wday = wday(dep_time, label = TRUE)) |>
group_by(wday) |>
summarise(mean_delay = mean(dep_delay, na.rm = TRUE)) |>
arrange(mean_delay) |>
ggplot(aes(x = wday, y = mean_delay)) +
geom_line()
flights_dt |>
mutate(wday = wday(dep_time, label = TRUE)) |>
group_by(wday) |>
summarise(mean_delay = mean(dep_delay, na.rm = TRUE)) |>
arrange(mean_delay) |>
ggplot(aes(x = wday, y = mean_delay)) +
geom_col(fill = "skyblue") +
labs(x = "Day of week", y = "Average departure delay")
library(tidyverse) # tidyverse::lubridate
library(nycflights13)
days(overnight)
flights |>
mutate(
overnight = arr_time < dep_time
)
flights |>
mutate(
overnight = arr_time < dep_time
) |>
days(overnight)
overnight
flights |>
mutate(
overnight = arr_time < dep_time
) |>
days(overnight)
library(tidyverse)
library(tidyverse)
x <- c(2,4,6,2,NA,435,NA)
x
fill(everything(x))
x <- tibble(c(2,4,6,2,NA,435,NA))
x
fill(everything(x))
y <- tibble(
melo = 32948,5,6,2,NA,3,23,NA
)
y <- tibble(
melo = 32948,5,6,2,NA,3,23,
)
y
y <- tibble(
melo = c(32948,5,6,2,NA,3,23)
)
y
y <- tibble(
melo = c(32948,5,6,2,NA,3,23,NA)
)
y
fill(everything(y))
y |>
fill(everything())
x |>
fill(everything())
coalesce(x,0)
x |>
coalesce(x,0)
x <-c(2,4,6,2,NA,435,NA)
coalesce(x,0)
coalesce(x,"ciao")
coalesce(x,"ciao")
x <-c(2,4,6,2,NA,435,NA)
coalesce(x,"ciao")
coalesce(x,3)
library(nycflights13)
flights |>
distinct(faa = dest)
flights |>
distinct(carrier) |>
anti_join(planes)
flights |>
distinct(carrier) |>
anti_join(planes)
flights |>
distinct(faa = dest) |>
anti_join(airports)
flights |>
distinct(carrier) |>
anti_join(planes)
flights |>
distinct(planes) |>
anti_join(carrier)
flights
install.packages(c("duckdb", "arrow"))
install.packages(c("repurrrsive", "jsonlite"))
install.packages("rvest")
install.packages("rlang")
a <- 10.8
class(a)
b <- 7L
class(b)
View(esoph)
frequency <- esoph %>%
mutate(f = (ncases/ncontrols) * 100) %>%
ggplot(aes(x = f)) +
geom_boxplot()
library(tidyverse)
frequency <- esoph %>%
mutate(f = (ncases/ncontrols) * 100) %>%
ggplot(aes(x = f)) +
geom_boxplot()
frequency <- esoph %>%
mutate(f = (ncases/ncontrols)
esoph %>%
esoph |>
mutate(f = (ncases/ncontrols) * 100) |>
ggplot(aes(x = f)) +
geom_boxplot()
esoph |>
mutate(f = (ncases/ncontrols) * 100) |>
group_by(agegp)
esoph |>
mutate(f = (ncases/ncontrols) * 100) |>
group_by(agegp) |>
ggplot(aes(x = f)) +
geom_boxplot()
mutate(f = (ncases/ncontrols) * 100)
esoph |>
group_by(agegp)
mutate(f = (ncases/ncontrols) * 100)
esoph |>
group_by(agegp)
mutate(f = (ncases/ncontrols) * 100)
esoph |>
group_by(agegp) |>
mutate(f = (ncases/ncontrols) * 100)
esoph |>
group_by(agegp) |>
mutate(f = (ncases/ncontrols) * 100) |>
ggplot(aes(x = f)) +
geom_boxplot()
esoph |>
group_by(agegp) |>
mutate(f = (ncases/ncontrols) * 100) |>
ggplot(aes(x = f, y = after_stat(prop))) +
geom_boxplot()
esoph |>
group_by(agegp) |>
mutate(f = (ncases/ncontrols) * 100) |>
ggplot(aes(x = f, y = after_stat())) +
geom_boxplot()
age_f <- esoph %>%
group_by(agegp) %>%
summarise(f = sum(ncases)) %>%
ggplot(aes(x = f, y = agegp)) +
geom_boxplot()
age_f
---
editor_options:
markdown:
wrap: 72
setwd("~/Bulk-RNAseq/downstream")
library(DESeq2)
library(AnnotationDbi)
library(EnhancedVolcano)
library(pheatmap)
library(org.Hs.eg.db)
library(clusterProfiler)
library(ReactomePA)
# ------------------------------------------------
#            Differentially Expressed Genes (DEGs)
# ------------------------------------------------
dds <- readRDS("dds.rds")
vsdata <- vst(dds, blind = FALSE)
colData <- as.data.frame(colData(dds))["condition"]
message("Loaded DESeq2 object with ", nrow(dds), " genes and ", ncol(dds), " samples")
# 01-Get the normalized results form DESeq object and get Symbol Gene
DEG_siOGT1 <- results(dds, contrast = c("condition", "siOGT1", "siNC"), alpha = 0.05)
DEG_siOGT2 <- results(dds, contrast = c("condition", "siOGT2", "siNC"), alpha = 0.05)
summary(DEG_siOGT1)
summary(DEG_siOGT2)
siOGT1_res <- as.data.frame(DEG_siOGT1)
siOGT1_res <- siOGT1_res[!is.na(siOGT1_res$padj),]
siOGT1_res$symbol <- mapIds(
org.Hs.eg.db,
keys = rownames(siOGT1_res),
keytype = "ENSEMBL",
column = "SYMBOL",
multiVals = "first"
)
siOGT2_res <- as.data.frame(DEG_siOGT2)
siOGT2_res <- siOGT2_res[!is.na(siOGT2_res$padj),]
siOGT2_res$symbol <- mapIds(
org.Hs.eg.db,
keys = rownames(siOGT2_res),
keytype = "ENSEMBL",
column = "SYMBOL",
multiVals = "first"
)
all(rownames(vsdata) %in% rownames(dds))
# 02-MA Plot
pdf("09_MA_siOGT.pdf")
plotMA(
DEG_siOGT1,
ylim = c(-7, 7),
alpha = 0.05,
main = "MA plot – siOGT1 vs Control"
)
abline(h = c(-1, 1), col = "grey50", lty = 2)
plotMA(DEG_siOGT2,
ylim = c(-7,7),
alpha = 0.05,
main = "MA plot – siOGT2 vs Control"
)
abline(h = c(-1,1), col="grey50", lty = 2)
dev.off()
# 03-VolcanoPlot_vs01
pdf("10_EnhancedVolcano_siOGT1.pdf")
EnhancedVolcano(
siOGT1_res,
lab = siOGT1_res$symbol,
x = "log2FoldChange",
y = "padj",
title = "Volcano plot – siOGT1 vs siNC",
subtitle = "All genes tested (DESeq2 results)"
)
EnhancedVolcano(
siOGT2_res,
lab = siOGT2_res$symbol,
x = "log2FoldChange",
y = "padj",
title = "Volcano plot – siOGT2 vs siNC",
subtitle = "All genes tested (DESeq2 results)"
)
dev.off()
# 03-Significant genes
significant1 <- siOGT1_res
significant1$threshold <- abs(siOGT1_res$log2FoldChange) > 0.5 & significant1$padj < 0.05
significant2 <- siOGT2_res
significant2$threshold <- abs(significant2$log2FoldChange) > 0.5 & significant2$padj < 0.05
# 04-VolcanoPlot_vs02 for significant genes
v1 <- ggplot(significant1, aes(x = log2FoldChange,
y = -log10(padj),
colour = threshold)) +
geom_point(alpha = 0.6, size = 1.6, na.rm = TRUE) +
scale_color_manual(values = c("FALSE" = "grey70", "TRUE" = "firebrick")) +
geom_vline(xintercept = c(-0.5, 0.5), linetype = "dashed", colour = "black") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed", colour = "black") +
labs(
title = "Volcano plot – siOGT1 vs siNC",
subtitle = "All genes tested; DEGs highlighted (adjusted p-value < 0.05, |log2FC| > 0.5)",
x = "log2 fold change",
y = "-log10 adjusted p-value",
colour = "Significant"
) +
coord_cartesian() +
theme_classic() +
theme(
axis.text  = element_text(size = 12),
axis.title = element_text(size = 14, face = "bold"),
legend.title = element_text(size = 12),
legend.text  = element_text(size = 11)
)
v2 <- ggplot(significant2, aes(x = log2FoldChange,
y = -log10(padj),
colour = threshold)) +
geom_point(alpha = 0.6, size = 1.6, na.rm = TRUE) +
scale_color_manual(values = c("FALSE" = "grey70", "TRUE" = "firebrick")) +
geom_vline(xintercept = c(-0.5, 0.5), linetype = "dashed", colour = "black") +
geom_hline(yintercept = -log10(0.05), linetype = "dashed", colour = "black") +
labs(
title = "Volcano plot – siOGT2 vs siNC",
subtitle = "All genes tested; DEGs highlighted (adjusted p-value < 0.05, |log2FC| > 0.5)",
x = "log2 fold change",
y = "-log10 adjusted p-value",
colour = "Significant"
) +
coord_cartesian() +
theme_classic() +
theme(
axis.text  = element_text(size = 12),
axis.title = element_text(size = 14, face = "bold"),
legend.title = element_text(size = 12),
legend.text  = element_text(size = 11)
)
pdf("11_VolcanoPlot_Highlighted_DEG.pdf")
print(v1)
print(v2)
dev.off()
# 05-Find DEGs
# siOGT1
DEG_siOGT1 <- filter(significant1, threshold == TRUE)
dim(DEG_siOGT1)
DEG_siOGT1_up <- DEG_siOGT1 |>
filter(log2FoldChange > 0)
DEG_siOGT1_up <- rownames(DEG_siOGT1_up)
DEG_siOGT1_down <- DEG_siOGT1 |>
filter(log2FoldChange < 0)
DEG_siOGT1_down <- rownames(DEG_siOGT1_down)
# siOGT2
DEG_siOGT2 <- filter(significant2, threshold == TRUE, )
dim(DEG_siOGT2)
DEG_siOGT2_up <- DEG_siOGT2 |>
filter(log2FoldChange > 0)
DEG_siOGT2_up <- rownames(DEG_siOGT2_up)
DEG_siOGT2_down <- DEG_siOGT2 |>
filter(log2FoldChange < 0)
DEG_siOGT2_down <- rownames(DEG_siOGT2_down)
# Common DEGs
DEG_common <- intersect(rownames(DEG_siOGT1), rownames(DEG_siOGT2))
DEG_common_up <- intersect(DEG_siOGT1_up, DEG_siOGT2_up)
DEG_common_down <- intersect(DEG_siOGT1_down, DEG_siOGT2_down)
cat(
"siOGT1-upregulated: ", length(DEG_siOGT1_up), "\n",
"siOGT1-downregulated: ", length(DEG_siOGT1_down), "\n",
"Total DEG for siOGT1: ", length(DEG_siOGT1_up) + length(DEG_siOGT1_down), "\n",
"\n",
"siOGT2-upregulated: ", length(DEG_siOGT2_up), "\n",
"siOGT2-downregulated: ", length(DEG_siOGT2_down), "\n",
"Total DEG for siOGT2: ", length(DEG_siOGT2_up) + length(DEG_siOGT2_down), "\n",
"\n",
"DEG common upregulated: ", length(DEG_common_up), "\n",
"DEG common downregulated: ", length(DEG_common_down), "\n",
"Total common DEG: ", length(DEG_common_up) + length(DEG_common_down)
)
# 06-Heatmap of DEGs
DEG_matrix1 <- assay(vsdata)[rownames(DEG_siOGT1),]
DEG_matrix2 <- assay(vsdata)[rownames(DEG_siOGT2), ]
DEG_common_matrix <- assay(vsdata)[DEG_common,]
# siOGT1
pdf("12_Heatmaps_DEGs.pdf", width = 10, height = 10)
h1 <- pheatmap(DEG_matrix1,
scale="row",
color = colorRampPalette(c("blue", "white", "red"))(100),
annotation_col = colData,
show_rownames = FALSE,
main = "siOGT1: DEGs padj < 0.05 & |log2FC| > 0.5"
)
# siOGT2
h2 <- pheatmap(DEG_matrix2, scale="row",
color = colorRampPalette(c("blue", "white", "red"))(100),
annotation_col = colData,
show_rownames = FALSE,
main = "siOGT2: DEGs padj < 0.05 & |log2FC| > 0.5"
)
# Common DEGs
pheatmap(DEG_common_matrix, scale="row",
color = colorRampPalette(c("blue", "white", "red"))(100),
annotation_col = colData,
show_rownames = FALSE,
main = "Common Genes for siOGT1 and siOGT2: DEGs padj < 0.05 & |log2FC| > 0.5"
)
dev.off()
# ------------------------------------------------
#            Gene Onthology (GO) on commong Genes
# ------------------------------------------------
# 07-Search GO terms
# up-regulated genes
GO_up <- enrichGO(gene = DEG_common_up,
OrgDb = "org.Hs.eg.db",
keyType = "ENSEMBL",
ont = "BP")
GO_up <- as.data.frame(GO_up)
dim(GO_up)
message("No GO terms for up-regulated genes")
# down-regulated genes
GO_down<- enrichGO(gene = DEG_common_down,
OrgDb = "org.Hs.eg.db",
keyType = "ENSEMBL",
ont = "BP")
GO_down<- as.data.frame(GO_down)
dim(GO_down)
message("Found ", nrow(GO_down), " terms for down-regulated genes")
GO_top_down <- GO_down |>
dplyr::arrange(p.adjust) |>
dplyr::slice_head(n = 20)
# barplot of top 20 GO terms
go <- ggplot(GO_top_down, aes(
x = reorder(Description, Count),
y = Count,
fill = -log10(p.adjust)))+
geom_col() +
coord_flip() +
scale_fill_viridis_c(name = "-log10(adj p-value)") +
theme_classic() +
labs(
x = NULL,
y = "Gene count",
title = "GO enrichment – Biological Process"
)
ggsave("13_GO_20BP.pdf", plot = go, width = 8, height = 6)
# ------------------------------------------------
#            Pathway Enrichment
# ------------------------------------------------
# 08-Pathway Enrichment using KEGG and Reactome
# Setup
DEG_common_down_entrezID <- mapIds(org.Hs.eg.db,
keys = DEG_common_down,
keytype = "ENSEMBL",
column = "ENTREZID",
multiVals = "first"
)
DEG_common_down_entrezID <- na.omit(DEG_common_down_entrezID)
background <- mapIds(org.Hs.eg.db,
keys = rownames(vsdata),
keytype = "ENSEMBL",
column = "ENTREZID",
multiVals = "first")
# KEGG database
kegg <- enrichKEGG(gene = DEG_common_down_entrezID,
organism = "hsa",
universe = background,
pvalueCutoff = 0.05,
qvalueCutoff = 0.1
)
kegg_df <- as.data.frame(kegg)
# Reactome databse
reactome <- enrichPathway(gene = DEG_common_down_entrezID,
organism = "human",
universe = background,
pvalueCutoff = 0.05,
qvalueCutoff = 0.1)
reactome_df <- as.data.frame(reactome)
# Visualization of pathway enrichment
# KEGG
pdf("14_PathwayEnrichment_KEGG.pdf", width = 10, height = 10)
dotplot(kegg,
showCategory = 15,
title = "KEGG Pathway Enrichment – Top 15 pathways (Down-regulated DEGs)"
)
kegg_readable <- setReadable(kegg, OrgDb = org.Hs.eg.db, keyType = "ENTREZID")
cnetplot(kegg,
showCategory = 8,
node_label = "category"
) +
ggtitle("KEGG Pathway Enrichment: Top 8 Pathways") +
theme(plot.title = element_text(hjust = 0.5))
kegg_df<- kegg_df|>
dplyr::arrange(p.adjust) |>
dplyr::slice_head(n = 20)
ggplot(kegg_df, aes(
x = reorder(Description, Count),
y = Count,
fill = -log10(p.adjust)))+
geom_col() +
coord_flip() +
scale_fill_viridis_c(name = "-log10(adj p-value)") +
theme_classic() +
labs(
x = NULL,
y = "Gene count",
title = "KEGG  Pathway Enrichment – Downregulated DEGs"
)
dev.off()
# Reactome
pdf("15_PathwayEnrichment_KEGG.pdf", width = 10, height = 10)
dotplot(reactome,
showCategory = 20,
title  = "Reactome Pathway Enrichment – Top 20 pathways (Down-regulated DEGs)"
)
reactome_readable <- setReadable(reactome, OrgDb = org.Hs.eg.db, keyType = "ENTREZID")
cnetplot(reactome_readable,
showCategory = 8,
node_label = "category") +
ggtitle("Reactome Pathway Enrichment: Top 8 Pathways") +
theme(plot.title = element_text(hjust = 0.5))
reactome_df <- reactome_df |>
dplyr::arrange(p.adjust) |>
dplyr::slice_head(n = 20)
ggplot(reactome_df, aes(
x = reorder(Description, Count),
y = Count,
fill = -log10(p.adjust)))+
geom_col() +
coord_flip() +
scale_fill_viridis_c(name = "-log10(adj p-value)") +
theme_classic() +
labs(
x = NULL,
y = "Gene count",
title = "Reactome Pathway Enrichment – Downregulated DEGs"
)
dev.off()
pdf("15_PathwayEnrichment_Reactome.pdf", width = 10, height = 10)
dotplot(reactome,
showCategory = 20,
title  = "Reactome Pathway Enrichment – Top 20 pathways (Down-regulated DEGs)"
)
reactome_readable <- setReadable(reactome, OrgDb = org.Hs.eg.db, keyType = "ENTREZID")
cnetplot(reactome_readable,
showCategory = 8,
node_label = "category") +
ggtitle("Reactome Pathway Enrichment: Top 8 Pathways") +
theme(plot.title = element_text(hjust = 0.5))
reactome_df <- reactome_df |>
dplyr::arrange(p.adjust) |>
dplyr::slice_head(n = 20)
ggplot(reactome_df, aes(
x = reorder(Description, Count),
y = Count,
fill = -log10(p.adjust)))+
geom_col() +
coord_flip() +
scale_fill_viridis_c(name = "-log10(adj p-value)") +
theme_classic() +
labs(
x = NULL,
y = "Gene count",
title = "Reactome Pathway Enrichment – Downregulated DEGs"
)
dev.off()
