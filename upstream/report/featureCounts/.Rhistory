flights_dt <- flights |>
filter(!is.na(dep_time), !is.na(arr_time)) |>
mutate(
dep_time = make_datetime_100(year, month, day, dep_time),
arr_time = make_datetime_100(year, month, day, arr_time),
sched_dep_time = make_datetime_100(year, month, day, sched_dep_time),
sched_arr_time = make_datetime_100(year, month, day, sched_arr_time)
) |>
select(origin, dest, ends_with("delay"), ends_with("time"))
flights_dt <- flights |>
filter(!is.na(dep_time), !is.na(arr_time)) |>
mutate(
dep_time = make_datetime_100(year, month, day, dep_time),
arr_time = make_datetime_100(year, month, day, arr_time),
sched_dep_time = make_datetime_100(year, month, day, sched_dep_time),
sched_arr_time = make_datetime_100(year, month, day, sched_arr_time)
) |>
select(origin, dest, ends_with("delay"), ends_with("time"))
flights_dt <- flights |>
filter(!is.na(dep_time), !is.na(arr_time)) |>
mutate(
dep_time = make_datetime_100(year, month, day, dep_time),
arr_time = make_datetime_100(year, month, day, arr_time),
sched_dep_time = make_datetime_100(year, month, day, sched_dep_time),
sched_arr_time = make_datetime_100(year, month, day, sched_arr_time)
) |>
select(origin, dest, year, ends_with("delay"), ends_with("time"))
flights_dt |>
group_by(year) |>
mutate(dep_hour = dep_time - floor_date(dep_time,"day")) |>
relocate(dep_hour, .before = 1) |>
ggplot(aes(x = dep_hour)) +
geom_line()
flights_dt |>
group_by(year) |>
mutate(dep_hour = hms::as_hms(dep_time - floor_date(dep_time,"day"))) |>
relocate(dep_hour, .before = 1) |>
ggplot(aes(x = dep_hour)) +
geom_freqpoly(binwidth = )
flights_dt |>
group_by(year) |>
mutate(dep_hour = hms::as_hms(dep_time - floor_date(dep_time,"day"))) |>
relocate(dep_hour, .before = 1) |>
ggplot(aes(x = dep_hour)) +
geom_freqpoly(binwidth = )
flights_dt |>
group_by(year) |>
mutate(dep_hour = as_hms(dep_time - floor_date(dep_time,"day"))) |>
relocate(dep_hour, .before = 1) |>
ggplot(aes(x = dep_hour)) +
geom_freqpoly(binwidth = )
library(hms)
flights_dt |>
group_by(year) |>
mutate(dep_hour = as_hms(dep_time - floor_date(dep_time,"day"))) |>
relocate(dep_hour, .before = 1) |>
ggplot(aes(x = dep_hour)) +
geom_freqpoly(binwidth = )
rlang::last_trace()
flights_dt |>
group_by(year) |>
mutate(dep_hour = as_hms(dep_time - floor_date(dep_time,"day"))) |>
relocate(dep_hour, .before = 1) |>
ggplot(aes(x = dep_hour)) +
geom_freqpoly(binwidth = 12)
flights_dt |>
group_by(year) |>
mutate(dep_hour = as_hms(dep_time - floor_date(dep_time,"day"))) |>
relocate(dep_hour, .before = 1) |>
ggplot(aes(x = dep_hour)) +
geom_freqpoly(binwidth = 60*30)
flights_dt |>
group_by(year) |>
mutate(dep_hour = as_hms(dep_time - floor_date(dep_time,"day"))) |>
relocate(dep_hour, .before = 1) |>
ggplot(aes(x = dep_hour)) +
geom_freqpoly(binwidth = 24)
flights_dt |>
group_by(year) |>
mutate(dep_hour = as_hms(dep_time - floor_date(dep_time,"day"))) |>
relocate(dep_hour, .before = 1) |>
ggplot(aes(x = dep_hour)) +
geom_freqpoly(binwidth = ) +
facet_grid(year)
flights_dt |>
group_by(year) |>
mutate(dep_hour = as_hms(dep_time - floor_date(dep_time,"day"))) |>
relocate(dep_hour, .before = 1) |>
ggplot(aes(x = dep_hour)) +
geom_freqpoly(binwidth = 100 ) +
facet_grid(year)
flights_dt |>
mutate(
dep_hour = hms::as_hms((dep_time %/% 100)*3600 + (dep_time %% 100)*60)
) |>
ggplot(aes(x = dep_hour)) +
geom_freqpoly(binwidth = 3600)  # binwidth in secondi
flights_dt |>
mutate(
dep_hour = dep_time %/% 100 + (dep_time %% 100)/60  # ora in formato decimale
) |>
ggplot(aes(x = dep_hour)) +
geom_freqpoly(binwidth = 1) +
scale_x_continuous(breaks = 0:23) +
labs(x = "Departure hour", y = "Count")
flights_dt |>
mutate(
dep_hour = as_hms(dep_time - floor_date(dep_time, "day"))  # ora del giorno come hms
) |>
ggplot(aes(x = dep_hour)) +
geom_freqpoly(binwidth = 3600) +   # binwidth in secondi (1 ora)
scale_x_time(breaks = scales::breaks_width("2 hours")) +
labs(x = "Departure time", y = "Count")
flights_dt |>
group_by(origin,dest) |>
mutate(
air_time2 = ((hour(dep_time)*60) + minute(dep_time))
)
flights_dt |>
group_by(origin,dest) |>
mutate(
air_time2 = ((hour(dep_time)*60) + minute(dep_time))
) |>
relocate(air_time2,air_time, .before = 1)
flights_dt |>
group_by(origin,dest) |>
mutate(
air_time2 = ((hour(arr_time)*60) + minute(arr_time)) - ((hour(dep_time)*60) + minute(dep_time))
) |>
relocate(air_time2,air_time, .before = 1)
flights |>
mutate(
week = floor_date(dep_time, "week")
)
flights |>
count(week = floor_date(dep_time, "week")) |>
ggplot(aes(x = week, y = dep_delay)) +
geom_line(aes(colour = year)) +
scale_color_continuous()
flights_dt |>
count(week = floor_date(dep_time, "week")) |>
ggplot(aes(x = week, y = dep_delay)) +
geom_line(aes(colour = year)) +
scale_color_continuous()
flights_dt |>
mutate(week = floor_date(dep_time, "week")) |>
ggplot(aes(x = week, y = dep_delay)) +
geom_line(aes(colour = year)) +
scale_color_continuous()
flights_dt |>
mutate(week = floor_date(dep_time, "day")) |>
ggplot(aes(x = week, y = dep_delay)) +
geom_line(aes(colour = year)) +
scale_color_continuous()
flights_dt |>
mutate(day = floor_date(dep_time, "day")) |>
ggplot(aes(x = day, y = dep_delay)) +
geom_line()
flights_dt |>
mutate(wday = wday(dep_time, label = TRUE)) |>
ggplot(aes(x = day, y = dep_delay)) +
geom_line()
flights_dt |>
mutate(wday = wday(dep_time, label = TRUE)) |>
ggplot(aes(x = wday, y = dep_delay)) +
geom_line()
flights_dt |>
mutate(wday = wday(dep_time, label = TRUE)) |>
group_by(wday) |>
summarise(mean_delay = mean(dep_delay, na.rm = TRUE)) |>
arrange(mean_delay) |>
ggplot(aes(x = wday, y = dep_delay)) +
geom_line()
flights_dt |>
mutate(wday = wday(dep_time, label = TRUE)) |>
group_by(wday) |>
summarise(mean_delay = mean(dep_delay, na.rm = TRUE)) |>
arrange(mean_delay) |>
ggplot(aes(x = mean_delay, y = dep_delay)) +
geom_line()
flights_dt |>
mutate(wday = wday(dep_time, label = TRUE)) |>
group_by(wday) |>
summarise(mean_delay = mean(dep_delay, na.rm = TRUE)) |>
arrange(mean_delay) |>
ggplot(aes(x = wday, y = mean_delay)) +
geom_line()
flights_dt |>
mutate(wday = wday(dep_time, label = TRUE)) |>
group_by(wday) |>
summarise(mean_delay = mean(dep_delay, na.rm = TRUE)) |>
arrange(mean_delay) |>
ggplot(aes(x = wday, y = mean_delay)) +
geom_col(fill = "skyblue") +
labs(x = "Day of week", y = "Average departure delay")
library(tidyverse) # tidyverse::lubridate
library(nycflights13)
days(overnight)
flights |>
mutate(
overnight = arr_time < dep_time
)
flights |>
mutate(
overnight = arr_time < dep_time
) |>
days(overnight)
overnight
flights |>
mutate(
overnight = arr_time < dep_time
) |>
days(overnight)
library(tidyverse)
library(tidyverse)
x <- c(2,4,6,2,NA,435,NA)
x
fill(everything(x))
x <- tibble(c(2,4,6,2,NA,435,NA))
x
fill(everything(x))
y <- tibble(
melo = 32948,5,6,2,NA,3,23,NA
)
y <- tibble(
melo = 32948,5,6,2,NA,3,23,
)
y
y <- tibble(
melo = c(32948,5,6,2,NA,3,23)
)
y
y <- tibble(
melo = c(32948,5,6,2,NA,3,23,NA)
)
y
fill(everything(y))
y |>
fill(everything())
x |>
fill(everything())
coalesce(x,0)
x |>
coalesce(x,0)
x <-c(2,4,6,2,NA,435,NA)
coalesce(x,0)
coalesce(x,"ciao")
coalesce(x,"ciao")
x <-c(2,4,6,2,NA,435,NA)
coalesce(x,"ciao")
coalesce(x,3)
library(nycflights13)
flights |>
distinct(faa = dest)
flights |>
distinct(carrier) |>
anti_join(planes)
flights |>
distinct(carrier) |>
anti_join(planes)
flights |>
distinct(faa = dest) |>
anti_join(airports)
flights |>
distinct(carrier) |>
anti_join(planes)
flights |>
distinct(planes) |>
anti_join(carrier)
flights
install.packages(c("duckdb", "arrow"))
install.packages(c("repurrrsive", "jsonlite"))
install.packages("rvest")
install.packages("rlang")
a <- 10.8
class(a)
b <- 7L
class(b)
View(esoph)
frequency <- esoph %>%
mutate(f = (ncases/ncontrols) * 100) %>%
ggplot(aes(x = f)) +
geom_boxplot()
library(tidyverse)
frequency <- esoph %>%
mutate(f = (ncases/ncontrols) * 100) %>%
ggplot(aes(x = f)) +
geom_boxplot()
frequency <- esoph %>%
mutate(f = (ncases/ncontrols)
esoph %>%
esoph |>
mutate(f = (ncases/ncontrols) * 100) |>
ggplot(aes(x = f)) +
geom_boxplot()
esoph |>
mutate(f = (ncases/ncontrols) * 100) |>
group_by(agegp)
esoph |>
mutate(f = (ncases/ncontrols) * 100) |>
group_by(agegp) |>
ggplot(aes(x = f)) +
geom_boxplot()
mutate(f = (ncases/ncontrols) * 100)
esoph |>
group_by(agegp)
mutate(f = (ncases/ncontrols) * 100)
esoph |>
group_by(agegp)
mutate(f = (ncases/ncontrols) * 100)
esoph |>
group_by(agegp) |>
mutate(f = (ncases/ncontrols) * 100)
esoph |>
group_by(agegp) |>
mutate(f = (ncases/ncontrols) * 100) |>
ggplot(aes(x = f)) +
geom_boxplot()
esoph |>
group_by(agegp) |>
mutate(f = (ncases/ncontrols) * 100) |>
ggplot(aes(x = f, y = after_stat(prop))) +
geom_boxplot()
esoph |>
group_by(agegp) |>
mutate(f = (ncases/ncontrols) * 100) |>
ggplot(aes(x = f, y = after_stat())) +
geom_boxplot()
age_f <- esoph %>%
group_by(agegp) %>%
summarise(f = sum(ncases)) %>%
ggplot(aes(x = f, y = agegp)) +
geom_boxplot()
age_f
---
editor_options:
markdown:
wrap: 72
clear
+clkean
clean
library(tidyverse)
library(DESeq2)
setwd('/Users/Bulk-RNAseq/upstream/report/featureCounts')
setwd('/Users/davidemaccarrone/Bulk-RNAseq/upstream/report/featureCounts')
counts <- read.table("counts.txt", sep = "\t", header = T, skip = 1)
View(counts)
dim(counts)
counts <- counts[, -c(2:6)]
View(counts)
rownames(counts) <- counts$Geneid
View
View(counts)
counts <- counts[, -1]
View(Counts)
View(counts)
sample <- c("siOGT2-2, siOGT2-1, siOGT1-2, siOGT1-1, siNC-2, siNC-1")
colnames(counts) <- sample
View(counts)
sample <- c("siOGT2-2", "siOGT2-1", "siOGT1-2", "siOGT1-1", "siNC-2", "siNC-1")
colnames(counts) <- sample
View(counts)
counts <-counts[rowSums(counts) > 0, ]
dim(counts)
dim(counts)
counts <-counts[rowSums(counts) > 0, ]
dim(counts)
counts <-counts[rowSums(counts) > 0, ]
dim(counts)
View(counts)
counts <- read.table("counts.txt", sep = "\t", header = T, skip = 1)
counts <- counts[, -c(2:6)]
rownames(counts) <- counts$Geneid
counts <- counts[, -1]
#02-Set the correct samples names (siOGT --> siRNA, siNC --> Negative CTRL) and remove
sample <- c("siOGT2-2", "siOGT2-1", "siOGT1-2", "siOGT1-1", "siNC-2", "siNC-1")
colnames(counts) <- sample
dim(counts)
counts <-counts[rowSums(counts) > 0, ]
dim(counts)
View(counts)
install.packages(airway)
install.packages("airway")
if (!requireNamespace("BiocManager", quietly = TRUE))
install.packages("BiocManager")
BiocManager::install("DESeq2")
a
version(DESeq2)
DESeq2
library(DESeq2)
package_version(DESeq2)
packageVersion("DESeq2")
colData <- data.frame(c("siOGT2-2", "siOGT2-1", "siOGT1-2", "siOGT1-1", "siNC-2", "siNC-1"))
colData
View(colData)
colData <- data.frame(condition = c("siOGT2-2", "siOGT2-1", "siOGT1-2", "siOGT1-1", "siNC-2", "siNC-1"))
colData
colData <- data.frame(condition = c("siRNA2-2", "siRNA1", "siRNA1-2", "siRNA1-1", "NegContr", "NegContr"))
rownames(colData) <- colnames(counts)
colData
colData <- data.frame(condition = c("siRNA2-2", "siRNA2-1", "siRNA1-2", "siRNA1-1", "NegContr", "NegContr"))
rownames(colData) <- colnames(counts)
View(colData)
colData <- data.frame(condition = c("siRNA2-2", "siRNA2-1", "siRNA1-2", "siRNA1-1", "NegContr-2", "NegContr-1"))
rownames(colData) <- colnames(counts)
colData <- data.frame(condition = c("siRNA2", "siRNA2", "siRNA1", "siRNA1", "NegContr", "NegContr"))
rownames(colData) <- colnames(counts)
all(colnames(counts) %in% rownames(colData))
all(colnames(counts) == rownames(colData))
dds <- DESeqDataSetFromMatrix(countData =  = counts,
dds <- DESeqDataSetFromMatrix(countData = counts,
colData = colData,
design = ~ condition)
colData <- data.frame(as.factor(condition = c("siRNA2", "siRNA2", "siRNA1", "siRNA1", "NegContr", "NegContr")))
colData <- data.frame(factor(condition = c("siRNA2", "siRNA2", "siRNA1", "siRNA1", "NegContr", "NegContr")))
colData <- data.frame(condition = factor(c("siRNA2", "siRNA2", "siRNA1", "siRNA1", "NegContr", "NegContr")))
rownames(colData) <- colnames(counts)
View(colData)
all(colnames(counts) %in% rownames(colData))
all(colnames(counts) == rownames(colData))
dds <- DESeqDataSetFromMatrix(countData = counts,
colData = colData,
design = ~ condition)
dds
colData <- data.frame(condition = factor(c("siRNA2", "siRNA2", "siRNA1", "siRNA1", "NegCTRL", "NegCTRL")))
rownames(colData) <- colnames(counts)
all(colnames(counts) %in% rownames(colData))
all(colnames(counts) == rownames(colData))
dds <- DESeqDataSetFromMatrix(countData = counts,
colData = colData,
design = ~ condition)
dds$condition <- relevel(dds$condition, ref = "NegCTRL")
dds$condition
dds <- DESeq(dds)
result <- results(dds)
result
View(result)
View(result)
View(result)
rm(res)
rm(result)
res_siRNA1 <- results(dds, contrast = c("condition", "siRNA1", "NegCTRL"))
res_siRNA1
res_siRNA2 <- results(dds, contrast = c("condition", "siRNA2", "NegCTRL"))
res_siRNA2
summary <- summary(res_siRNA1, res_siRNA2)
summary(res_siRNA1, res_siRNA2)
summary <- summary(res_siRNA1)
summary-siRNA2 <- summary(res_siRNA2)
summary-siRNA2 <- summary(res_siRNA2)
summary-siRNA2 <- summary(res_siRNA2)
summary-siRNA2 <- summary(res_siRNA2)
summary_siRNA1 <- summary(res_siRNA1)
summary_siRNA2 <- summary(res_siRNA2)
summary_siRNA1
summary_siRNA1
View(summary_siRNA1)
summary_siRNA1
summary(res_siRNA1)
summary(res_siRNA2)
res_siRNA1_p001 <- results(dds, contrast = c("condition", "siRNA1", "NegCTRL"), alpha = 0.01)
res_siRNA2_p001 <- results(dds, contrast = c("condition", "siRNA2", "NegCTRL"), alpha = 0.01)
summary(res_siRNA1_p001)
summary(res_siRNA2_p001)
summary(res_siRNA1_p01)
summary(res_siRNA2_p01)
clean
res_siRNA1_p01 <- results(dds, contrast = c("condition", "siRNA1", "NegCTRL"))
res_siRNA2_p01 <- results(dds, contrast = c("condition", "siRNA2", "NegCTRL"))
summary(res_siRNA1_p01)
summary(res_siRNA2_p01)
summary(res_siRNA1_p001)
summary(res_siRNA2_p001)
counts <-counts[rowSums(counts) > 10, ]
dim(counts)
colData <- data.frame(condition = factor(c("siRNA2", "siRNA2", "siRNA1", "siRNA1", "NegCTRL", "NegCTRL")))
rownames(colData) <- colnames(counts)
all(colnames(counts) %in% rownames(colData))
all(colnames(counts) == rownames(colData))
dds <- DESeqDataSetFromMatrix(countData = counts,
colData = colData,
design = ~ condition)
dds$condition <- relevel(dds$condition, ref = "NegCTRL")
dds <- DESeq(dds)
res_siRNA1_p01 <- results(dds, contrast = c("condition", "siRNA1", "NegCTRL"))
res_siRNA2_p01 <- results(dds, contrast = c("condition", "siRNA2", "NegCTRL"))
res_siRNA1_p001 <- results(dds, contrast = c("condition", "siRNA1", "NegCTRL"), alpha = 0.01)
res_siRNA2_p001 <- results(dds, contrast = c("condition", "siRNA2", "NegCTRL"), alpha = 0.01)
summary(res_siRNA1_p01)
summary(res_siRNA2_p01)
summary(res_siRNA1_p001)
summary(res_siRNA2_p001)
# 07-MA plot
plotMA(res_siRNA1_p001)
# 07-MA plot
plotMA(res_siRNA1_p001)
plotMA(res_siRNA1_p002)
plotMA(res_siRNA1_p002)
plotMA(res_siRNA2_p001)
write.csv(as.data.frame(res_siRNA1_p001), "DEGs_siRNA1_p001.csv")
write.csv(as.data.frame(res_siRNA2_p001), "DEGs_siRNA1_p002.csv")
pwd
get()
pwd()
getwd()
norm_counts <- counts(dds, normalized = TRUE)
norm_counts <- DESeq2::counts(dds, normalized = TRUE)
write.csv(norm_counts, "norm_count_matrix.csv")
write.csv(as.data.frame(norm_counts, "norm_count_matrix.csv"))
# 07-MA plot
plotMA(res_siRNA1_p001)
plotMA(res_siRNA2_p001)
